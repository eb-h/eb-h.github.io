---
title: Flare-On 8
layout: single
author_profile: true
toc: true
toc_label: Table of Contents
toc_sticky: true
date: '2021-10-29 00:00:00'
tags:
- ctf/rev
- writeup
- wip
---

This year is the first year I've finished Flare-On! I found challenge 9 to be the toughest, while challenges 6 and 10 were probably my favourites. 

# 1 - credchecker

We're given some HTML. At the end of the html page, we can see to enter `Admin` for username, `atob('goldenticket')` for password. `atob` converts base64 to ascii, so do the reverse. 

Username: `Admin`
Password: `Z29sZGVudGlja2V0`

Flag: `enter_the_funhouse@flare-on.com`

# 2 - known

We're given `UnlockYourFiles.exe` and some encrypted files. It's a ransomware decryptor given when the ransomware is run, and it includes a ransom note. 

```
**********                                                                                                   
Attention!                                                                                                   
**********                                                                                                   
                                                                                                             
Your documents, photos, and other important files have been encrypted with a strong algorithm.               
                                                                                                             
Don't try and change file extensions! It can be dangerous for the encrypted information!                     
                                                                                                             
The only way to recover (decrypt) your files is to run this decryptor with the unique private key.           
Attention! Only we can recover your files! If someone tell you that he can do this, kindly ask him to proof! 
                                                                                                             
Below you will see a big base64 blob, you will need to email us and copy this blob to us.                    
You must pay all but 1 BTC to 48 hours for recover it. After 48 hours we will leaked all your data!          
                                                                                                             
KD4wXzApPiBJdCdzIGRhbmdlcm91cyB0byBhZGQrcm9yIGFsb25lISBUYWtlIHRoaXMgPCgwXzA8KQo=                             
                                                                                                             
Enter the decryption key and press Enter: 
```

When provided with the correct key it will decrypt any files in the local `Files` directory. The intent is that that the key is given after paying the ransom, but it turns out that the encryption method is weak enough that we can figure out the key on our own.  

Data is encrypted 8 bytes at a time:
```python
def decrypt(chunk: bytearray, xor_key: bytes)
    for i, x in enumerate(xor_key):
        chunk[i] = ((x ^ chunk[i]) << i) - i
    return chunk
```

Each byte is encrypted independently so it can be solved independently, so if we know eight bytes of plaintext we can solve the key. One of the files encrypted is a PNG, and PNGs have eight byte headers `   137 80 78 71 13 10 26 10`. 

I wanted some practice with Z3 so I wrote the following script:
```python
from z3 import *

png_first_eight_bytes = [137, 80, 78, 71, 13, 10, 26, 10]
discovered_first_eight_bytes = [0xc7, 0xc7, 0x25, 0x1d, 0x63, 0x0d, 0xf3, 0x56]

s = Solver()

key_bytes = [BitVec('k{}'.format(i), 8) for i in range(8)]
for i, k in enumerate(key_bytes):
    s.add(png_first_eight_bytes[i] == RotateLeft(k ^ discovered_first_eight_bytes[i], i) - i)

res = b''
if s.check() == sat:
    m = s.model()
    for i, k in enumerate(key_bytes):
        val = m[k].as_long()
        res += bytes([val])
        print(i, hex(val), chr(val))
print(res)
```

It returns the key `No1Trust`, can then apply an XOR in cyberchef to get the flag. 

Flag: `You_Have_Awakened_Me_Too_Soon_EXE@flare-on.com`


# 3 - AntiochOS
# 4 - myaquaticlife
# 5 - FLARE Linux VM
# 6 - PetTheKitty
# 7 - spel
# 8 - beelogin
# 9 - evil
# 10 - wizardcult
